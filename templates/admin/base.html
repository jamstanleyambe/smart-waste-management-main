{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="NONE,NOARCHIVE">
    <title>{% block title %}{% endblock %}</title>
    
    <!-- Django Admin CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/base.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/nav_sidebar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/dark_mode.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/login.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/responsive.css' %}">
    
    <!-- Custom Admin CSS -->
    {% block extrastyle %}{% endblock %}
    
    <!-- Django Admin JS -->
    <script src="{% static 'admin/js/theme.js' %}"></script>
    <script src="{% static 'admin/js/nav_sidebar.js' %}"></script>
</head>

<body class="{% block bodyclass %}{% endblock %}">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <!-- Container -->
    <div id="container">
        <!-- Header -->
        <div id="header">
            <div id="branding">
                <h1 id="site-name">
                    <a href="{% url 'admin:index' %}">
                        {% block branding %}{% endblock %}
                    </a>
                </h1>
            </div>
            {% block usertools %}
            {% if has_permission %}
            <div id="user-tools">
                {% block welcome-msg %}
                    Welcome,
                    <strong>{% firstof user.get_short_name user.get_username %}</strong>.
                {% endblock %}
                {% block userlinks %}
                    {% if site_url %}
                        <a href="{{ site_url }}">View site</a> /
                    {% endif %}
                    {% if user.is_active and user.is_staff %}
                        {% url 'django-admindocs-docroot' as docsroot %}
                        {% if docsroot %}
                            <a href="{{ docsroot }}">Documentation</a> /
                        {% endif %}
                    {% endif %}
                    {% if user.has_usable_password %}
                        <a href="{% url 'admin:password_change' %}">Change password</a> /
                    {% endif %}
                    <a href="{% url 'admin:logout' %}">Log out</a>
                {% endblock %}
            </div>
            {% endif %}
            {% endblock %}
        </div>
        
        <!-- Content -->
        <div id="content" class="{% block coltype %}colM{% endblock %}">
            <!-- Sidebar -->
            {% block nav-sidebar %}
            <div id="nav-sidebar">
                <h2>Navigation</h2>
                
                <!-- Search Box -->
                <div class="sidebar-search">
                    <input type="text" id="sidebar-search" placeholder="üîç Search navigation..." class="search-input">
                </div>
                
                <ul id="sidebar-nav">
                    <li><a href="{% url 'admin:index' %}" data-search="dashboard home main">üè† Dashboard</a></li>
                    <li><a href="{% url 'admin:core_bin_changelist' %}" data-search="bins waste collection trash">üóëÔ∏è Bins</a></li>
                    <li><a href="{% url 'admin:core_truck_changelist' %}" data-search="trucks vehicles fleet transport">üöõ Trucks</a></li>
                    <li><a href="{% url 'admin:core_dumpingspot_changelist' %}" data-search="dumping spots disposal sites locations">üìç Dumping Spots</a></li>
                    <li><a href="{% url 'admin:core_role_changelist' %}" data-search="roles permissions user roles access">üë• Roles</a></li>
                    <li><a href="{% url 'admin:index' %}" data-search="users accounts user management">üë§ Users</a></li>
                </ul>
                
                <!-- Sidebar Stats -->
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <span class="stat-icon">üìä</span>
                        <span class="stat-text">System Active</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üîÑ</span>
                        <span class="stat-text">Real-time Data</span>
                    </div>
                </div>
            </div>
            {% endblock %}
            
            <!-- Main Content -->
            <div id="content-main">
                {% block content %}
                    {% block object-tools %}{% endblock %}
                    {{ content }}
                {% endblock %}
            </div>
            
            <!-- Breadcrumbs -->
            {% block breadcrumbs %}
            <div class="breadcrumbs">
                <a href="{% url 'admin:index' %}">Home</a>
                {% if title %} &rsaquo; {{ title }}{% endif %}
            </div>
            {% endblock %}
        </div>
        
        <!-- Footer -->
        <div id="footer">
            <div class="footer-content">
                <p>&copy; 2025 Smart Waste Management System. Built with ‚ù§Ô∏è for sustainable waste management.</p>
            </div>
        </div>
    </div>
    
    <!-- Django Admin JS -->
    <script src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
    <script src="{% static 'admin/js/jquery.init.js' %}"></script>
    <script src="{% static 'admin/js/core.js' %}"></script>
    <script src="{% static 'admin/js/actions.js' %}"></script>
    <script src="{% static 'admin/js/urlify.js' %}"></script>
    <script src="{% static 'admin/js/prepopulate.js' %}"></script>
    <script src="{% static 'admin/js/vendor/xregexp/xregexp.js' %}"></script>
    
    <!-- Custom Admin JavaScript -->
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('nav-sidebar');
            const isOpen = sidebar.classList.contains('open');
            
            if (isOpen) {
                sidebar.classList.remove('open');
            } else {
                sidebar.classList.add('open');
            }
        }
        
        // Sidebar search functionality
        function initSidebarSearch() {
            const searchInput = document.getElementById('sidebar-search');
            const navItems = document.querySelectorAll('#sidebar-nav li');
            
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    
                    navItems.forEach(item => {
                        const link = item.querySelector('a');
                        const searchData = link.getAttribute('data-search') || '';
                        const text = link.textContent.toLowerCase();
                        
                        if (searchTerm === '' || text.includes(searchTerm) || searchData.includes(searchTerm)) {
                            item.classList.remove('hidden');
                            item.classList.remove('highlighted');
                        } else {
                            item.classList.add('hidden');
                        }
                    });
                    
                    // Highlight matching items
                    if (searchTerm !== '') {
                        navItems.forEach(item => {
                            if (!item.classList.contains('hidden')) {
                                item.classList.add('highlighted');
                            }
                        });
                    }
                });
                
                // Clear search on escape key
                searchInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        this.value = '';
                        this.dispatchEvent(new Event('input'));
                        this.blur();
                    }
                });
            }
        }
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('nav-sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !toggle.contains(event.target) && 
                sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('nav-sidebar');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
            }
        });
        
        // Initialize search when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initSidebarSearch();
        });
    </script>
    
    {% block extrajs %}{% endblock %}
</body>
</html>
